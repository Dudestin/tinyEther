# 共通ファイル

## `rtl/`
このディレクトリはあらゆるアプリケーションで共通して利用できるモジュール群を格納しています.

### `FRAME_FIFO.v`
`EOD`, `frame_exist`など，フレームやパケットを扱う際に有用な信号を付加した非同期式FIFO.
PHYから受信した非同期の信号をFPGA内での処理クロックに載せ換える際に有用.

### `MAC_DEC.v`
EthernetフレームのFCSを検査し，有効であればヘッダとその他のメタ情報を付加し`HEADER_FIFO`に出力.
ペイロードは`BODY_FIFO`に分けて出力する.
フレーム全体のCRC32値を計算し, 結果を定数`0xC704_DD7B`と比較することで破損をチェックする.

### `crc.v`
`MAC_DEC.v`でFCSをチェックする際に利用. 8bitパラレル入力.

### `mutex.v`
ハードウェアによる排他制御サポート. 該当するリソースを使用したい場合, `req`をアサートし, `val`が1になれば使用を開始できる. 
使用を完了したら, `req`をデアサートする. 

### `sync_2ff.v`
シンクロナイザ. 非同期信号をクロックに同期させる際に使用することで，メタステーブルによる悪影響を抑制することができる.

### `vec_sync_2ff.v`
ベクトルシンクロナイザ. グレイコードやワンホットコードに適用する. 

### `RMII_TX.v`
100Mbpsかつ全二重で通信が行われていることを前提としたRMII送信モジュール.

### `RMII_RX.v`
100Mbpsで通信が行われていることを前提としたRMII受信モジュール.

### `SNI_TX.v`
100Mbpsかつ半二重で通信が行われていることを前提としたSNI送信モジュール.
SNIは一部の低速PHYのみが対応する特殊なMII (Media-Independent Interface).

### `SNI_RX.v`
SNI (Serial Network Interface)受信モジュール.

### `MDIO.v`
PHYを制御するMDIOバスの入出力を行うモジュール. メモリマップドインターフェースを備えており, CPUからアクセスが可能. 入力クロックを32分周し`MDC`を生成する. 
各MDIOはMDCの立ち下がりでアサートされる.

### `bin2gray.v`
通常の2進数からグレイコードに変換するモジュール.

### `gray2bin.v`
グレイコードから通常の2進数に変換するモジュール.

### `PACKET_FIFO.v`
`EOD`信号を備えた, パケット等の区切りをもつ信号を扱う際に有用なFIFO.
入力，出力クロックが同期していることを前提としている.
非同期のクロックで動作するデバイスを扱う場合は, `FRAME_FIFO.v`などを使用してください.

## `constraints/`
このディレクトリは, 共通して利用できるIO制約やタイミング制約を格納します。

### `io.adc`
４つのPHYすべてのRMIIインターフェース, MDIOのIO制約を網羅しています。
加えて, Tang PriMER自体のLEDやクリスタル, ボタン (USR_BTN)の制約を備えます.
適宜変更してご利用ください。

### `timing.adc`
４つのPHYすべてのRMIIインターフェースを網羅しています。
加えて, Tang PriMER自体が備えるリスタル (24MHz) の制約を備えます.
適宜変更してご利用ください。
